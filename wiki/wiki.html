<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STLNBO Wiki â€” Firebase</title>
  <style>
    /* ... seu CSS igual ... */
  </style>
  <!-- Firebase SDKs -->
  <script type="module">
    // Importa Firebase (do CDN, sem instalar nada)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ðŸ”¥ Cole suas credenciais do Firebase aqui
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "XXXXXX",
      appId: "XXXXXX"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ===============================
    // === LÃ³gica do seu Wiki ========
    // ===============================
    const $ = s=>document.querySelector(s);

    const state = {
      items: [],
      editingId: null
    };

    const els = {
      cards: $('#cards'),
      name: $('#name'),
      desc: $('#desc'),
      imageFile: $('#imageFile'),
      imageURL: $('#imageURL'),
      saveBtn: $('#saveBtn'),
      resetBtn: $('#resetBtn'),
      editHint: $('#editHint'),
      formCard: $('#formCard')
    };

    // --- RenderizaÃ§Ã£o
    function render(){
      els.cards.innerHTML = '';
      for(const it of state.items){
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <img src="${it.image||''}" alt="">
          <div class="body">
            <h3>${it.name}</h3>
            <p class="muted">${it.desc}</p>
            <div class="controls">
              <button class="btn small" data-id="${it.id}" data-act="edit">Editar</button>
              <button class="btn small danger" data-id="${it.id}" data-act="del">Excluir</button>
            </div>
          </div>
        `;
        els.cards.appendChild(card);
      }
    }

    // --- CRUD no Firestore
    async function addEntry(data){
      await addDoc(collection(db,"wiki"), data);
    }

    async function updateEntry(id,data){
      await updateDoc(doc(db,"wiki",id), data);
    }

    async function deleteEntry(id){
      await deleteDoc(doc(db,"wiki",id));
    }

    // --- BotÃ£o salvar
    els.saveBtn.addEventListener('click', async ()=>{
      const name = els.name.value.trim();
      const desc = els.desc.value.trim();
      if(!name) return alert("Precisa de nome");

      let image = els.imageURL.value.trim();
      if(els.imageFile.files[0]){
        image = URL.createObjectURL(els.imageFile.files[0]); // simples (pode usar storage depois)
      }

      if(state.editingId){
        await updateEntry(state.editingId,{name,desc,image});
        state.editingId=null;
      }else{
        await addEntry({name,desc,image,createdAt:Date.now()});
      }

      els.name.value="";
      els.desc.value="";
      els.imageFile.value="";
      els.imageURL.value="";
    });

    // --- Eventos de clique (editar/deletar)
    els.cards.addEventListener('click', async e=>{
      const id = e.target.dataset.id;
      const act = e.target.dataset.act;
      if(!id) return;
      if(act==="del"){
        if(confirm("Excluir?")) await deleteEntry(id);
      }
      if(act==="edit"){
        const item = state.items.find(i=>i.id===id);
        if(item){
          state.editingId = id;
          els.name.value=item.name;
          els.desc.value=item.desc;
          els.imageURL.value=item.image;
          els.editHint.classList.remove("hidden");
        }
      }
    });

    // --- Carregar em tempo real
    onSnapshot(collection(db,"wiki"), snap=>{
      state.items = snap.docs.map(d=>({id:d.id,...d.data()}));
      render();
    });

  </script>
</head>
<body>
  <header><div class="wrap"><h1>STLNBO Wiki â€” <span class="muted">Firebase</span></h1></div></header>
  <main class="wrap">
    <section id="formCard" class="card">
      <div class="body">
        <h2>Adicionar / Editar Entrada</h2>
        <div class="row">
          <input id="name" type="text" placeholder="Nome do personagem" />
        </div>
        <div class="row">
          <textarea id="desc" placeholder="DescriÃ§Ã£o"></textarea>
        </div>
        <div class="row">
          <input id="imageURL" type="text" placeholder="URL da imagem" />
          <input type="file" id="imageFile" />
        </div>
        <button id="saveBtn" class="btn brand">Salvar</button>
        <button id="resetBtn" class="btn ghost">Limpar</button>
        <span id="editHint" class="badge hidden">Editandoâ€¦</span>
      </div>
    </section>
    <section id="cards" class="grid"></section>
  </main>
</body>
</html>
